---
alwaysApply: false
---
# Правила разработки с помощью LLM для проекта

## Обязательные проверки качества кода

### Перед каждым коммитом
- Всегда запускай `make ci` перед коммитом
- Убедись, что все тесты проходят: `make test`
- Проверь форматирование: `make fmt`
- Проверь линтинг: `make lint`
- Проверь типизацию: `make typecheck`

### Структура разработки
1. **Реализуй задачу инкрементально** - небольшими шагами
2. **Добавляй/корректируй тесты** для каждой задачи
3. **Запускай `make ci`** после каждого значимого изменения
4. **Коммить только при зеленом статусе** всех проверок

## Тестирование

### Обязательные тесты
- Покрытие кода должно быть > 80%
- Тесты должны быть быстрыми и изолированными
- Используй `pytest` для всех тестов
- Тестируй как успешные, так и ошибочные сценарии

### Структура тестов
```python
def test_function_name_success_case():
    """Тест успешного выполнения функции"""
    # Arrange
    # Act
    # Assert

def test_function_name_error_case():
    """Тест обработки ошибок"""
    # Arrange
    # Act
    # Assert
```

## Качество кода

### Типизация
- Все функции должны иметь типы параметров и возвращаемых значений
- Используй `mypy` для проверки типов
- Избегай `Any` - используй конкретные типы

### Форматирование и линтинг
- Используй `ruff` для форматирования и линтинга
- Длина строки: 100 символов
- Используй двойные кавычки для строк
- Следуй PEP 8 и современным стандартам Python

### Архитектура
- Следуй принципу единственной ответственности
- Используй dependency injection где возможно
- Избегай глубокой вложенности
- Применяй паттерны проектирования где уместно

## Коммиты

### Формат сообщений
Используй Conventional Commits:
- `feat(scope): описание новой функциональности`
- `fix(scope): описание исправления бага`
- `chore(scope): технические изменения`
- `docs(scope): изменения в документации`
- `ci(scope): изменения в CI/CD`
- `refactor(scope): рефакторинг без изменения функциональности`

### Примеры
```
feat(cli): add new build command
fix(parser): handle empty config files
chore(deps): update pytest to 8.0.0
docs(api): add usage examples
```

## Работа с LLM

### При разработке новой функциональности
1. Сначала напиши тесты (TDD подход)
2. Реализуй минимальную рабочую версию
3. Запусти `make ci`
4. Итеративно улучшай код
5. Добавляй документацию и примеры

### При исправлении багов
1. Напиши тест, который воспроизводит баг
2. Исправь код так, чтобы тест прошел
3. Убедись, что не сломал существующие тесты
4. Запусти `make ci`

### При рефакторинге
1. Убедись, что все тесты проходят до рефакторинга
2. Делай небольшие изменения
3. Запускай `make ci` после каждого изменения
4. Не меняй функциональность во время рефакторинга

## Инструменты разработки

### Обязательные команды
- `make setup` - настройка окружения
- `make fmt` - форматирование кода
- `make lint` - проверка стиля кода
- `make typecheck` - проверка типов
- `make test` - запуск тестов
- `make ci` - все проверки сразу
- `make clean` - очистка временных файлов

### Pre-commit хуки
- Автоматически устанавливаются при `make setup`
- Проверяют код перед каждым коммитом
- Включают форматирование, линтинг и базовые проверки

## Безопасность и производительность

### Безопасность
- Валидируй все входные данные с помощью Pydantic
- Используй type hints для предотвращения ошибок
- Обрабатывай исключения корректно

### Производительность
- Профилируй код при необходимости
- Используй асинхронность где уместно
- Оптимизируй только после измерения

## Документация

### Код
- Используй docstrings для всех публичных функций
- Следуй Google docstring format
- Объясняй сложную логику в комментариях

### API
- Документируй все публичные методы
- Предоставляй примеры использования
- Обновляй документацию при изменении API

## Отладка

### При возникновении проблем
1. Запусти `make ci` для проверки базовых проблем
2. Используй `pytest -v` для подробного вывода тестов
3. Используй `pytest --pdb` для отладки
4. Проверь логи и исключения

### Мониторинг
- Следи за покрытием тестов
- Отслеживай время выполнения тестов
- Мониторь качество кода через линтеры

## Итоговый чеклист перед коммитом

- [ ] Все тесты проходят (`make test`)
- [ ] Код отформатирован (`make fmt`)
- [ ] Линтинг проходит (`make lint`)
- [ ] Типизация корректна (`make typecheck`)
- [ ] Покрытие тестов достаточное
- [ ] Документация обновлена
- [ ] Сообщение коммита следует Conventional Commits
- [ ] `make ci` проходит полностью

**Помни: код должен быть готов к продакшену после каждого коммита!**